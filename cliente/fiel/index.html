<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dep√≥sito R√°pido - G√°s e √Ågua</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gas: {
                            light: '#FFEDD5',
                            DEFAULT: '#F97316', // Laranja
                            dark: '#C2410C'
                        },
                        water: {
                            light: '#E0F2FE',
                            DEFAULT: '#0EA5E9', // Azul
                            dark: '#0369A1'
                        },
                        brand: {
                            dark: '#0F172A',
                            bg: '#F8FAFC'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8FAFC;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 120px;
        }

        /* Scrollbar oculta */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* Inputs estilizados */
        .input-field {
            width: 100%;
            padding: 14px;
            border: 1px solid #E2E8F0;
            border-radius: 12px;
            font-size: 16px;
            outline: none;
            transition: all 0.2s;
            background-color: #fff;
            color: #1E293B;
        }
        .input-field:focus {
            border-color: #0EA5E9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.15);
        }

        /* Bot√µes de Categoria */
        .cat-btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .cat-btn:active { transform: scale(0.95); }
        
        /* Estilo Ativo para G√°s */
        .cat-btn.active-gas {
            background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
            border: none;
        }
        /* Estilo Ativo para √Ågua */
        .cat-btn.active-water {
            background: linear-gradient(135deg, #0EA5E9 0%, #0284C7 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
            border: none;
        }
        
        .cat-btn.inactive {
            background-color: #ffffff;
            color: #64748B;
            border: 1px solid #E2E8F0;
        }

        /* Card de Pagamento Melhorado */
        .payment-card-input:checked + .payment-card {
            border-color: #0EA5E9;
            background-color: #F0F9FF;
            color: #0284C7;
            box-shadow: 0 0 0 2px #0EA5E9 inset;
        }
        .payment-card-input:checked + .payment-card i {
            color: #0284C7;
        }

        /* Anima√ß√µes */
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-animate { animation: slideUp 0.35s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes pulse-subtle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
    </style>
</head>
<body>

    <header class="relative bg-white pb-6 rounded-b-[2.5rem] shadow-sm overflow-hidden z-10">
        <div class="absolute top-0 left-0 right-0 h-32 bg-gradient-to-r from-water-dark to-gas-dark opacity-90"></div>
        
        <div class="relative flex flex-col items-center pt-8 px-4">
            <div class="w-24 h-24 bg-white rounded-2xl flex items-center justify-center shadow-lg mb-3 border-4 border-white transform rotate-3 hover:rotate-0 transition-transform duration-300">
                <div class="flex flex-col items-center leading-none">
                    <i class="fa-solid fa-droplet text-water text-3xl mb-1"></i>
                    <i class="fa-solid fa-fire text-gas text-2xl"></i>
                </div>
            </div>

            <h1 class="text-2xl font-extrabold text-gray-800 tracking-tight">Dep√≥sito R√°pido</h1>
            <p class="text-gray-500 text-sm font-medium mb-4">G√°s P13, P45 e √Ågua Mineral</p>
            
            <div class="flex items-center gap-2 bg-slate-100 px-4 py-1.5 rounded-full border border-slate-200 shadow-sm">
                <div id="status-indicator" class="w-2.5 h-2.5 rounded-full bg-gray-300"></div>
                <span id="status-text" class="text-xs font-bold text-slate-600 uppercase tracking-wide">Verificando...</span>
                <span class="text-[10px] text-slate-400 border-l border-slate-300 pl-2 ml-1">08h √†s 18h</span>
            </div>
        </div>
    </header>

    <nav class="sticky top-0 z-40 bg-[#F8FAFC]/95 backdrop-blur-md py-4 transition-all duration-300" id="nav-menu">
        <div class="flex justify-center gap-3 px-4 overflow-x-auto scrollbar-hide">
            
            <button onclick="filterMenu('gas')" id="btn-gas" class="cat-btn inactive flex-1 py-3 px-5 rounded-xl text-sm font-bold text-center min-w-[105px] shadow-sm flex flex-col items-center gap-1">
                <i class="fa-solid fa-fire-flame-curved text-lg"></i>
                <span>G√°s</span>
            </button>
            
            <button onclick="filterMenu('agua')" id="btn-agua" class="cat-btn inactive flex-1 py-3 px-5 rounded-xl text-sm font-bold text-center min-w-[105px] shadow-sm flex flex-col items-center gap-1">
                <i class="fa-solid fa-bottle-water text-lg"></i>
                <span>√Ågua</span>
            </button>
            
            <button onclick="filterMenu('acessorios')" id="btn-acessorios" class="cat-btn inactive flex-1 py-3 px-5 rounded-xl text-sm font-bold text-center min-w-[105px] shadow-sm flex flex-col items-center gap-1">
                <i class="fa-solid fa-wrench text-lg"></i>
                <span>Pe√ßas</span>
            </button>

        </div>
    </nav>

    <main class="max-w-4xl mx-auto p-4 min-h-[50vh]">
        <div id="menu-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 pb-24">
            </div>
    </main>

    <div id="cart-float" onclick="openCart()" class="fixed bottom-6 left-4 right-4 bg-gray-900 text-white p-4 rounded-2xl shadow-2xl flex justify-between items-center cursor-pointer transform translate-y-[150%] transition-all duration-300 z-50 hover:bg-black active:scale-95 border border-white/10 group">
        <div class="flex items-center gap-4">
            <div class="bg-white text-black w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shadow-inner relative">
                <span id="cart-count">0</span>
                <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-gray-900"></div>
            </div>
            <div class="flex flex-col">
                <span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Total (sem entrega)</span>
                <span class="font-bold text-xl leading-none" id="cart-total-float">R$ 0,00</span>
            </div>
        </div>
        <div class="flex items-center font-bold text-sm gap-2 bg-white/10 px-4 py-2 rounded-xl group-hover:bg-white/20 transition">
            Ver Sacola <i class="fas fa-chevron-right text-xs"></i>
        </div>
    </div>

    <div id="checkout-modal" class="fixed inset-0 bg-gray-900/80 hidden z-50 backdrop-blur-sm transition-opacity opacity-0" style="transition: opacity 0.3s;">
        <div class="h-full w-full flex items-end sm:items-center justify-center p-0 sm:p-4">
            
            <div onclick="event.stopPropagation()" class="bg-white w-full max-w-lg h-[92vh] sm:h-auto sm:max-h-[90vh] rounded-t-3xl sm:rounded-3xl shadow-2xl modal-animate flex flex-col relative">
                
                <div class="bg-white px-6 py-4 border-b border-gray-100 flex justify-between items-center rounded-t-3xl sticky top-0 z-20">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">Finalizar Pedido</h2>
                        <p class="text-xs text-gray-500">Confira seus itens e dados</p>
                    </div>
                    <button onclick="closeCart()" class="w-10 h-10 rounded-full bg-gray-50 text-gray-500 flex items-center justify-center hover:bg-gray-100 hover:text-red-500 transition text-lg">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="p-6 overflow-y-auto scrollbar-hide flex-1 bg-gray-50/50">
                    
                    <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-6">
                        <div id="cart-items-list" class="space-y-4"></div>
                    </div>

                    <form id="checkout-form" class="space-y-6">
                        
                        <div class="bg-gray-200 p-1 rounded-xl flex">
                            <button type="button" onclick="toggleOrderType('delivery')" id="btn-type-delivery" class="flex-1 py-3 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition shadow-sm bg-white text-blue-600">
                                <i class="fas fa-motorcycle"></i> Entrega
                            </button>
                            <button type="button" onclick="toggleOrderType('pickup')" id="btn-type-pickup" class="flex-1 py-3 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition text-gray-500 hover:bg-gray-50">
                                <i class="fas fa-store"></i> Retirar
                            </button>
                        </div>

                        <div class="space-y-3">
                            <p class="text-sm font-bold text-gray-800 flex items-center gap-2"><i class="far fa-user"></i> Seus Dados</p>
                            <div class="grid grid-cols-1 gap-3">
                                <input type="text" id="client-name" placeholder="Seu Nome Completo" class="input-field" required>
                                <input type="tel" id="client-phone" placeholder="WhatsApp (11) 99999-9999" class="input-field" maxlength="15" required inputmode="numeric">
                            </div>
                        </div>

                        <div id="address-container" class="transition-all duration-300 overflow-hidden">
                            <div class="space-y-3">
                                <p class="text-sm font-bold text-gray-800 flex items-center gap-2"><i class="fas fa-map-pin text-red-500"></i> Onde entregar?</p>
                                <input type="text" id="address-street" placeholder="Rua e N√∫mero" class="input-field">
                                <div class="grid grid-cols-2 gap-3">
                                    <input type="text" id="address-district" placeholder="Bairro" class="input-field">
                                    <input type="text" id="address-comp" placeholder="Complemento" class="input-field">
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <p class="text-sm font-bold text-gray-800 mb-3 flex items-center gap-2"><i class="far fa-credit-card"></i> Pagamento</p>
                            
                            <div class="grid grid-cols-3 gap-3">
                                <label class="cursor-pointer">
                                    <input type="radio" name="payment" value="PIX" class="payment-card-input hidden" onchange="togglePayment('pix')">
                                    <div class="payment-card h-24 rounded-xl border-2 border-gray-100 bg-white flex flex-col items-center justify-center gap-2 transition hover:border-gray-300">
                                        <i class="fa-brands fa-pix text-2xl text-teal-500"></i>
                                        <span class="text-xs font-bold text-gray-600">PIX</span>
                                    </div>
                                </label>

                                <label class="cursor-pointer">
                                    <input type="radio" name="payment" value="Cart√£o" class="payment-card-input hidden" checked onchange="togglePayment('card')">
                                    <div class="payment-card h-24 rounded-xl border-2 border-gray-100 bg-white flex flex-col items-center justify-center gap-2 transition hover:border-gray-300">
                                        <i class="fas fa-credit-card text-2xl text-blue-500"></i>
                                        <span class="text-xs font-bold text-gray-600">Cart√£o</span>
                                    </div>
                                </label>

                                <label class="cursor-pointer">
                                    <input type="radio" name="payment" value="Dinheiro" class="payment-card-input hidden" onchange="togglePayment('money')">
                                    <div class="payment-card h-24 rounded-xl border-2 border-gray-100 bg-white flex flex-col items-center justify-center gap-2 transition hover:border-gray-300">
                                        <i class="fas fa-money-bill-wave text-2xl text-green-500"></i>
                                        <span class="text-xs font-bold text-gray-600">Dinheiro</span>
                                    </div>
                                </label>
                            </div>

                            <div class="mt-4">
                                <div id="box-money" class="hidden animate-[slideUp_0.2s_ease-out]">
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Troco para quanto?</label>
                                    <input type="tel" id="client-change" placeholder="Ex: R$ 50,00" class="input-field" oninput="formatCurrencyInput(this)">
                                </div>

                                <div id="box-pix" class="hidden bg-teal-50 p-4 rounded-xl border border-teal-100 text-center animate-[slideUp_0.2s_ease-out]">
                                    <p class="text-xs text-teal-800 font-bold mb-2 uppercase tracking-wide">Chave PIX (CNPJ/Email)</p>
                                    
                                    <div class="flex gap-2 items-center mb-3">
                                        <input type="text" value="00.000.000/0001-00" id="pix-key-input" class="w-full bg-white border border-teal-200 p-3 rounded-lg text-center font-mono font-bold text-gray-600 outline-none text-sm" readonly>
                                        <button type="button" onclick="copyPixRobust()" class="bg-teal-600 text-white p-3 rounded-lg hover:bg-teal-700 transition shadow-sm">
                                            <i class="far fa-copy"></i>
                                        </button>
                                    </div>
                                    <p class="text-[10px] text-teal-600 font-medium">O entregador conferir√° o comprovante.</p>
                                </div>
                            </div>
                        </div>

                    </form>
                </div>

                <div class="bg-white p-4 border-t border-gray-100 rounded-b-3xl space-y-3">
                    <div class="flex justify-between items-end">
                        <div>
                            <p class="text-xs text-gray-500 mb-1">Total a pagar (c/ entrega)</p>
                            <p id="summary-total" class="text-2xl font-extrabold text-gray-900">R$ 0,00</p>
                        </div>
                        <div class="text-right">
                             <span id="delivery-fee-badge" class="text-xs font-bold bg-green-100 text-green-700 px-2 py-1 rounded">Entrega R$ 5,00</span>
                        </div>
                    </div>

                    <button type="button" onclick="finalizeOrder()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-200 flex items-center justify-center gap-3 transition-all transform active:scale-[0.98] text-lg">
                        <i class="fab fa-whatsapp text-2xl"></i> Enviar Pedido
                    </button>
                </div>

            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script>
        const CONFIG = {
            PHONE: "5511999999999", // SUBSTITUA AQUI PELO SEU N√öMERO
            DELIVERY_FEE: 5.00,
            OPEN_HOUR: 8,
            CLOSE_HOUR: 18
        };

        // --- CAT√ÅLOGO G√ÅS E √ÅGUA ---
        const menuItems = [
            // === G√ÅS ===
            { id: 101, name: "G√°s de Cozinha P13", desc: "Botij√£o tradicional (13kg). Marca certificada.", price: 110.00, cat: "gas", img: "https://placehold.co/300x300/F97316/FFFFFF?text=GAS+P13", bestSeller: true },
            { id: 102, name: "G√°s Industrial P45", desc: "Cilindro para com√©rcio (45kg).", price: 420.00, cat: "gas", img: "https://placehold.co/300x300/EA580C/FFFFFF?text=GAS+P45", bestSeller: false },

            // === √ÅGUA ===
            { id: 201, name: "√Ågua Mineral 20L", desc: "Gal√£o retorn√°vel (Apenas o l√≠quido).", price: 14.00, cat: "agua", img: "https://placehold.co/300x300/0EA5E9/FFFFFF?text=AGUA+20L", bestSeller: true },
            { id: 202, name: "√Ågua Mineral 500ml", desc: "Fardo com 12 unidades (Sem g√°s).", price: 22.00, cat: "agua", img: "https://placehold.co/300x300/38BDF8/FFFFFF?text=FARDO+500ML", bestSeller: false },
            { id: 203, name: "√Ågua c/ G√°s 500ml", desc: "Fardo com 12 unidades (Com g√°s).", price: 24.00, cat: "agua", img: "https://placehold.co/300x300/0284C7/FFFFFF?text=COM+GAS", bestSeller: false },

            // === ACESS√ìRIOS ===
            { id: 301, name: "V√°lvula Reguladora", desc: "Regulador de press√£o com selo Inmetro.", price: 45.00, cat: "acessorios", img: "https://placehold.co/300x300/94A3B8/FFFFFF?text=VALVULA", bestSeller: false },
            { id: 302, name: "Mangueira (Metro)", desc: "Alta resist√™ncia e validade longa.", price: 10.00, cat: "acessorios", img: "https://placehold.co/300x300/64748B/FFFFFF?text=MANGUEIRA", bestSeller: false },
        ];

        let cart = {}; 
        let currentOrderType = 'delivery';

        document.addEventListener("DOMContentLoaded", () => {
            renderMenu('gas'); // Come√ßa na aba G√°s
            checkShopStatus();
            setupPhoneMask();
            setInterval(checkShopStatus, 60000);
        });

        const formatMoney = (value) => {
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        function checkShopStatus() {
            const now = new Date();
            const hour = now.getHours();
            // L√≥gica simples: Aberto entre CONFIG.OPEN_HOUR e CONFIG.CLOSE_HOUR
            // Pode adicionar dias da semana se quiser (ex: && now.getDay() !== 0)
            const isOpen = hour >= CONFIG.OPEN_HOUR && hour < CONFIG.CLOSE_HOUR;
            
            const indicator = document.getElementById('status-indicator');
            const text = document.getElementById('status-text');

            if(isOpen) {
                indicator.className = "w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse";
                text.innerText = "Aberto Agora";
                text.className = "text-xs font-bold text-green-600 uppercase tracking-wide";
            } else {
                indicator.className = "w-2.5 h-2.5 rounded-full bg-red-500";
                text.innerText = "Fechado";
                text.className = "text-xs font-bold text-red-500 uppercase tracking-wide";
            }
        }

        // --- RENDERIZA√á√ÉO DO MENU ---
        function renderMenu(category) {
            const container = document.getElementById('menu-container');
            container.innerHTML = "";

            // Atualiza bot√µes
            ['gas', 'agua', 'acessorios'].forEach(cat => {
                const btn = document.getElementById(`btn-${cat}`);
                btn.className = 'cat-btn inactive flex-1 py-3 px-5 rounded-xl text-sm font-bold text-center min-w-[105px] shadow-sm flex flex-col items-center gap-1';
                
                if(cat === category) {
                    if(cat === 'gas') btn.classList.add('active-gas');
                    else if(cat === 'agua') btn.classList.add('active-water');
                    else btn.classList.replace('inactive', 'active-water'); // Acess√≥rios usa azul tbm
                    
                    btn.classList.remove('inactive');
                }
            });

            const filtered = menuItems.filter(i => i.cat === category);

            if(filtered.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-12 text-gray-400">Nenhum item dispon√≠vel.</div>`;
                return;
            }

            filtered.forEach(item => {
                const qty = cart[item.id] || 0;
                // Define cor de borda baseada na categoria
                let borderColor = item.cat === 'gas' ? 'hover:border-gas' : 'hover:border-water';
                
                const html = `
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex gap-4 items-center transition-all ${borderColor} relative overflow-hidden group">
                        
                        <div class="w-24 h-24 relative flex-shrink-0 bg-gray-50 rounded-xl overflow-hidden">
                            ${item.bestSeller ? '<div class="absolute top-0 left-0 bg-yellow-400 text-yellow-900 text-[9px] font-black px-1.5 py-0.5 z-10">MAIS VENDIDO</div>' : ''}
                            <img src="${item.img}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                        </div>

                        <div class="flex-1 min-w-0">
                            <h3 class="font-bold text-gray-800 text-lg leading-tight mb-1 truncate">${item.name}</h3>
                            <p class="text-xs text-gray-500 line-clamp-2 mb-3">${item.desc}</p>
                            
                            <div class="flex justify-between items-center">
                                <span class="font-extrabold text-gray-900 text-xl tracking-tight">${formatMoney(item.price)}</span>
                                <div id="controls-${item.id}">
                                    ${getControlHTML(item.id, qty, item.cat)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        function getControlHTML(id, qty, cat) {
            // Cores din√¢micas para bot√µes
            const btnColor = cat === 'gas' ? 'bg-gas text-white hover:bg-gas-dark' : 'bg-water text-white hover:bg-water-dark';
            const textColor = cat === 'gas' ? 'text-gas' : 'text-water';

            if (qty === 0) {
                return `<button onclick="updateQty(${id}, 1)" class="h-10 px-5 rounded-lg ${btnColor} font-bold text-sm shadow-md transition-transform active:scale-95">COMPRAR</button>`;
            }
            return `
                <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-1 border border-gray-200">
                    <button onclick="updateQty(${id}, -1)" class="w-8 h-8 flex items-center justify-center bg-white rounded shadow-sm text-gray-600 hover:text-red-500 transition"><i class="fas fa-minus text-xs"></i></button>
                    <span class="font-bold text-base w-6 text-center ${textColor}">${qty}</span>
                    <button onclick="updateQty(${id}, 1)" class="w-8 h-8 flex items-center justify-center bg-white rounded shadow-sm text-gray-600 hover:text-green-500 transition"><i class="fas fa-plus text-xs"></i></button>
                </div>
            `;
        }

        window.filterMenu = (cat) => {
            renderMenu(cat);
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        window.updateQty = (id, change) => {
            if (!cart[id]) cart[id] = 0;
            cart[id] += change;
            if (cart[id] <= 0) delete cart[id];
            
            // Re-renderiza o controle espec√≠fico sem recarregar tudo (Performance)
            const item = menuItems.find(i => i.id == id);
            const controlDiv = document.getElementById(`controls-${id}`);
            if (controlDiv) controlDiv.innerHTML = getControlHTML(id, cart[id] || 0, item.cat);
            
            updateFloatingCart();
            if(!document.getElementById('checkout-modal').classList.contains('hidden')) {
                renderCartList();
            }
        }

        function updateFloatingCart() {
            const totalQty = Object.values(cart).reduce((a, b) => a + b, 0);
            const totalPrice = Object.keys(cart).reduce((sum, id) => {
                const item = menuItems.find(i => i.id == id);
                return sum + (item.price * cart[id]);
            }, 0);

            const floatBar = document.getElementById('cart-float');
            document.getElementById('cart-count').innerText = totalQty;
            document.getElementById('cart-total-float').innerText = formatMoney(totalPrice);

            if (totalQty > 0) {
                floatBar.style.transform = "translateY(0)";
            } else {
                floatBar.style.transform = "translateY(150%)";
            }
        }

        // --- MODAL ---
        window.openCart = () => {
            if(Object.keys(cart).length === 0) return;
            renderCartList();
            const modal = document.getElementById('checkout-modal');
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.remove('opacity-0'), 10);
            document.body.style.overflow = 'hidden';
        }

        window.closeCart = () => {
            const modal = document.getElementById('checkout-modal');
            modal.classList.add('opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }, 300);
        }

        function renderCartList() {
            const list = document.getElementById('cart-items-list');
            list.innerHTML = "";
            let itensTotal = 0;

            if(Object.keys(cart).length === 0) {
                closeCart();
                return;
            }

            Object.keys(cart).forEach(id => {
                const item = menuItems.find(i => i.id == id);
                const qty = cart[id];
                const totalItem = item.price * qty;
                itensTotal += totalItem;

                list.innerHTML += `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-0 last:pb-0">
                        <div class="flex items-center gap-3">
                            <span class="bg-gray-100 text-gray-700 text-xs font-bold px-2 py-1 rounded-md border border-gray-200">${qty}x</span>
                            <div class="flex flex-col">
                                <span class="text-sm font-bold text-gray-800">${item.name}</span>
                                <span class="text-xs text-gray-400">${formatMoney(item.price)} un.</span>
                            </div>
                        </div>
                        <div class="text-right">
                             <span class="font-bold text-gray-900 text-sm block">${formatMoney(totalItem)}</span>
                             <button onclick="updateQty(${item.id}, -1)" class="text-[10px] text-red-500 hover:underline">Remover</button>
                        </div>
                    </div>
                `;
            });

            updateTotals(itensTotal);
        }

        function updateTotals(subtotal) {
            const deliveryFee = currentOrderType === 'delivery' ? CONFIG.DELIVERY_FEE : 0;
            const total = subtotal + deliveryFee;

            document.getElementById('summary-total').innerText = formatMoney(total);
        }

        window.toggleOrderType = (type) => {
            currentOrderType = type;
            const btnDel = document.getElementById('btn-type-delivery');
            const btnPick = document.getElementById('btn-type-pickup');
            const addrContainer = document.getElementById('address-container');
            const badge = document.getElementById('delivery-fee-badge');

            if(type === 'delivery') {
                // UI States
                btnDel.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
                btnDel.classList.remove('text-gray-500', 'hover:bg-gray-50');
                
                btnPick.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                btnPick.classList.add('text-gray-500', 'hover:bg-gray-50');

                addrContainer.style.height = "auto";
                addrContainer.style.opacity = "1";
                addrContainer.style.marginTop = "12px";
                
                badge.classList.remove('hidden');
            } else {
                btnPick.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
                btnPick.classList.remove('text-gray-500', 'hover:bg-gray-50');

                btnDel.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                btnDel.classList.add('text-gray-500', 'hover:bg-gray-50');

                addrContainer.style.height = "0";
                addrContainer.style.opacity = "0";
                addrContainer.style.marginTop = "0";
                
                badge.classList.add('hidden');
            }
            
            // Recalcula total
            const subtotal = Object.keys(cart).reduce((sum, id) => {
                const item = menuItems.find(i => i.id == id);
                return sum + (item.price * cart[id]);
            }, 0);
            updateTotals(subtotal);
        }

        window.togglePayment = (type) => {
            document.getElementById('box-money').classList.add('hidden');
            document.getElementById('box-pix').classList.add('hidden');
            
            if(type === 'money') document.getElementById('box-money').classList.remove('hidden');
            if(type === 'pix') document.getElementById('box-pix').classList.remove('hidden');
        }

        window.copyPixRobust = function() {
            const textToCopy = document.getElementById('pix-key-input').value;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    Toastify({ text: "Chave PIX copiada!", duration: 3000, style: { background: "#0D9488" } }).showToast();
                });
            } else {
                // Fallback simples
                alert("PIX: " + textToCopy);
            }
        }

        function setupPhoneMask() {
            const phoneInput = document.getElementById('client-phone');
            phoneInput.addEventListener('input', (e) => {
                let v = e.target.value.replace(/\D/g, "");
                v = v.replace(/^(\d{2})(\d)/g, "($1) $2");
                v = v.replace(/(\d)(\d{4})$/, "$1-$2");
                e.target.value = v;
            });
        }

        window.formatCurrencyInput = (input) => {
            let value = input.value.replace(/\D/g, '');
            value = (value / 100).toFixed(2) + '';
            value = value.replace(".", ",");
            value = value.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
            input.value = "R$ " + value;
        }

        window.finalizeOrder = () => {
            const safeVal = (id) => document.getElementById(id).value.trim();
            
            const name = safeVal('client-name');
            const phone = safeVal('client-phone');
            const street = safeVal('address-street');
            const district = safeVal('address-district');
            const comp = safeVal('address-comp');
            const change = safeVal('client-change');
            
            if(name.length < 3 || phone.length < 10) {
                Toastify({ text: "Informe Nome e Telefone corretamente.", style: { background: "#EF4444" } }).showToast();
                return;
            }

            if(currentOrderType === 'delivery') {
                if(street.length < 5 || district.length < 3) {
                    Toastify({ text: "Preencha o endere√ßo de entrega.", style: { background: "#EF4444" } }).showToast();
                    return;
                }
            }

            // Constru√ß√£o da Mensagem
            let msg = `üî• *PEDIDO DE G√ÅS/√ÅGUA* üî•%0A`;
            msg += `üë§ *Cliente:* ${name}%0A`;
            msg += `üì± *Tel:* ${phone}%0A%0A`;
            
            msg += `üì¶ *ITENS:*%0A`;
            Object.keys(cart).forEach(id => {
                const item = menuItems.find(i => i.id == id);
                msg += `‚ñ™Ô∏è ${cart[id]}x ${item.name}%0A`;
            });
            
            const subtotal = Object.keys(cart).reduce((sum, id) => menuItems.find(i => i.id == id).price * cart[id], 0);
            const total = subtotal + (currentOrderType === 'delivery' ? CONFIG.DELIVERY_FEE : 0);

            msg += `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ%0A`;
            if(currentOrderType === 'delivery') {
                msg += `üõµ *ENTREGA (${formatMoney(CONFIG.DELIVERY_FEE)})* %0A`;
                msg += `üìç ${street}, ${district} ${comp ? '('+comp+')' : ''}%0A`;
            } else {
                msg += `üéí *RETIRADA NO LOCAL* %0A`;
            }

            const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
            msg += `üí∞ *TOTAL: ${formatMoney(total)}*%0A`;
            msg += `üí≥ *Pagamento:* ${paymentMethod}`;
            
            if(paymentMethod === 'Dinheiro' && change) msg += ` (Troco para ${change})`;
            if(paymentMethod === 'PIX') msg += ` (Pagamento via PIX)`;

            // Envio
            const link = `https://wa.me/${CONFIG.PHONE}?text=${msg}`;
            window.open(link, '_blank');
        }
    </script>
</body>
</html>